jeese
314159

发现里面，点名说的那样，我发四个坐标给你，然后你发回这四个坐标之内的用户的数据
李猜猜  21:39:37
本用户也包括的喔
王金鑫  21:40:30
行，到时候我会把本用户处理掉的
有时候这四个坐标里面是没有本用户的
李猜猜  21:41:34
哦哦
接口地址是什么啊
李猜猜  21:42:36
用户数据包括什么
王金鑫  21:43:18
discover_finduser
用户数据就是用户的信息表中的数据，你看原来那个用户信息表怎么设计的可以参考下
李猜猜  21:44:27
哦哦。
120.24.208.130/api/discover/finduser
想这样子？
王金鑫  21:45:33
行吧
李猜猜  21:45:44
发过来的时候除了四个坐标还有这四个坐标搜寻次数要不要？
王金鑫  21:45:47
你看怎么好怎么弄
李猜猜  21:45:51
因为有可能第二次读
王金鑫  21:46:27
嘛意思，就是我可能会发两次一样的这个请求？
李猜猜  21:46:37
对的
你会不会
就像附近的人你不断往下拉嘛
会不会这样
王金鑫  21:48:39
使用起来是这样的，就是屏幕有个地图，然后我会根据屏幕四个角的地图上的坐标请求用户的数据，获取到以后，我显示出来，等用户拖动地图或者缩放以后，我再根据新的坐标去获取新的用户信息
王金鑫  21:49:50
有个问题是用户拖动或者缩放以后，可能有一部分用户的数据我之前已经获取到了，怎么样不用去再次下载相同的用户数据？
不过，只有一条json的话，数据量也不大，坐标更新后就去再获取新的数据倒是也可以
你看怎么做好点？
李猜猜  21:50:51
你只要计算出那些你获取过的范围
找新的没获取过的范围就可以啦
就是，你可以把屏幕划分成四块
可能左下那一块获取过
其他三个你分别发过来咯
也是可以的
王金鑫  21:55:22
那这样子，我把上次的范围和这次的范围还有两个范围之间的时间间隔都发给你，然后时间间隔很短的话，你就把这次的范围里的数据除去新的返回给我，如果间隔较长，就全部返回？
李猜猜  21:57:00
那我岂不是要弄缓存。嗯……我看看
我先记下来吧。暂定这样
王金鑫  21:59:17
我刚才试了一下别的软件，我用的时候感觉他们是这样子做的，就是根据四个角的坐标，然后把四个坐标的范围扩大一点，去请求数据，然后地图拖动一点点，只要不超出请求的范围就不向服务器发请求，当范围超出时，再请求新的数据，如此类推
这样可能用户体验好点
王金鑫  22:16:40
求助的话，会有一个时间限制，到了时间限制后，就不再公共的数据流里出现了，客户端这里会让用户选择会重新发个求助还是确认删去
不管怎样，到了时间限制以后不再会被其他用户看到了
王金鑫  22:18:54
上传的参数的话，就只需要求助消息本身的参数了吧，求助者你服务器自己加上去
王金鑫  22:28:43
那么我发的数据里面包括：  发送时间，有效时间，求助内容文本，经度，纬度，位置文本，城市编码，求助目标，位置可见性
还有图片是另外传的
afinal
王金鑫  22:30:43
json里面先这么多吧，其他的东西到时候有需求再加，我也没想到别的了


发送时间，有效时间，求助内容文本，经度，纬度，位置文本，城市编码，求助目标，位置可见性，图片数量，标签1，标签2，标签3，标签4，标签5息


王金鑫  22:46:01
ok
那你就根据你那边的情况，告诉我按什么顺序写json就好了
李猜猜  22:47:21
好的
王金鑫  22:49:49
下载求职消息的时候，我参考了一下新浪微博的api
王金鑫  22:50:54
我会发送一个since_id
王金鑫  22:51:55
如果为0的话，你就选最新的25条消息返回，如果不为零的话，你就返回比since_id的时间晚一点的消息
李猜猜  22:53:08
OK
王金鑫  22:54:14
如果我下拉刷新的话，会看有没新的消息，你觉得怎么设计接口好点，不要返回多余的数据
我把客户端当前最新的消息的id也发上去，你返回比这个新的消息？
李猜猜  22:55:23
这个可以
其实还是要看数据库怎么设计
未读信息怎么挂钩用户
用户应该只看自己关注的信息的吧
如果那样子的话，可能就会有一个表专门存储用户的未读信息
那就直接返回这个
李猜猜  22:56:33
如果没有这种表的话，可以采用你上面那个方法
王金鑫  22:57:51
就是系统筛选出的适合这个用户的消息，会推送过去，然后在用户的重要消息列表里出现，然后再求助列表里是这个城市的所有消息的列表
你觉得怎么样
李猜猜  23:00:33
哦，那这个就是帮助者的客户端咯。可以啊。建议和他们讨论一下数据库设计，我不太懂。可以问问。应该承受得了。
王金鑫  23:02:23

就是现在是弄第二个求助列表的下载接口
李猜猜  23:04:06
OK
王金鑫  23:09:28
那返回消息你觉得是根据定位的城市编码返回本地的数据还是根据经纬度返回一定距离的数据？
李猜猜  23:11:42
其实差不多
mysql计算能力应该没啥问题吧
我才
猜
得测试
王金鑫  23:14:21
嗯，那先根据城市编码吧，方便，你再测试下经纬度，如果没问题的话经纬度更好一点吧
李猜猜  23:16:40
OK
王金鑫  23:17:31
嗯，那获取求助消息的时候我就上传，城市编码，经度，纬度，since
since_id
这样可以吧？
李猜猜  23:24:40
求助信息也是要考虑附近的人咯？！
这个OK
也就这么传吧
王金鑫  23:25:53
since_id为0，返回最新的25条，sinceid为1，返回最大id之后最小id之前的新消息（也就是id比最大id更大，比最小id更小），不足25条都发，超过25条只发25条，剩下的我再刷新时获取，最大最小id为客户端已经获取的最旧的消息的id，最大最小为客户端那边根据消息列表的情况改变，sinceid不为0或1时，返回比sinceid小的消息25条
李猜猜  23:26:38
那要把那个id也发过来哦
王金鑫  23:26:51
经纬度先没什么用，到时候如果计算附近的快就不用城市编码了，现在两个都传方便你测试
session
？
李猜猜  23:27:31
session不记你查过什么信息的哦
你想记上？
王金鑫  23:28:23
不用记的，我根据客户端的情况去取数据，情况就是以上的那几种
李猜猜  23:28:40
OK
没问题
王金鑫  23:28:55
你可以看下新浪微博的获取微博的api，我是根据那个想得
先根据城市编码获取消息，经纬度是没什么用的，方便你测试，如果经纬度也很快了，就可以计算范围来获取消息了
这样


